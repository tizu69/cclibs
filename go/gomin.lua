local a=require("cc.expect").expect;if _ENV.go then return end;local b={}function _ENV.go(c)a(1,c,"function")local d={f=coroutine.create(c),t=nil}table.insert(b,1,d)return function()d.f=coroutine.create(function()end)end end;return function(e,f)a(1,e,"function")a(2,f,"function","nil")if#b==0 then error("No goroutines to run")end;while true do local g={e()}for h=#b,1,-1 do local i=b[h]if coroutine.status(i.f)=="suspended"and(i.t==nil or i.t==g[1])then local j,k=coroutine.resume(i.f,table.unpack(g))if j then i.t=k else printError("<go>"..tostring(k))table.remove(b,h)end end;if coroutine.status(i.f)=="dead"then table.remove(b,h)end end;if#b==0 then break end;if f and f(b,g)==true then break end end;_ENV.go=nil end
